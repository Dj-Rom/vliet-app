import{f as J}from"./chunk-WHIQFPGR.js";import{a as et}from"./chunk-GV2WZ6SY.js";import{a as q}from"./chunk-LD5LC5PG.js";import{h as tt}from"./chunk-KFXH5GP6.js";import{a as G,c as K,g as Q,l as U,m as X,n as Y,r as Z}from"./chunk-KBOLL6IX.js";import{f as z,g as R,h as j}from"./chunk-AWDAIWPN.js";import{$a as C,Ca as N,Ha as p,Ta as L,Ua as D,Va as $,Wa as m,Xa as n,Y as y,Ya as l,Z as f,Za as A,_a as x,a as k,ab as h,b as B,db as E,e as P,eb as s,fb as v,jb as c,kb as O,lb as b,nb as w,ob as W,pb as M,sa as d,sb as H,ub as V,vb as S,ya as I}from"./chunk-XTGCJEIM.js";function lt(e,i){if(e&1&&(n(0,"option",8),c(1),l()),e&2){let t=i.$implicit,a=s();m("value",t),d(),O(a.months[t])}}function rt(e,i){if(e&1&&(x(0),c(1),C()),e&2){let t=s().$implicit;d(),b(" ",t.truck," ")}}function at(e,i){if(e&1&&(n(0,"option",8),c(1),l()),e&2){let t=i.$implicit;m("value",t.vehicle_number),d(),O(t.vehicle_number)}}function ot(e,i){if(e&1){let t=h();n(0,"select",18),M("ngModelChange",function(r){y(t);let o=s().$implicit;return W(o.truck,r)||(o.truck=r),f(r)}),p(1,at,2,2,"option",19),l()}if(e&2){let t=s().$implicit,a=s();w("ngModel",t.truck),d(),m("ngForOf",a.vehicleFleetList.trucks)}}function st(e,i){if(e&1&&(x(0),c(1),C()),e&2){let t=s().$implicit;d(),b(" ",t.trailer," ")}}function ct(e,i){if(e&1&&(n(0,"option",8),c(1),l()),e&2){let t=i.$implicit;m("value",t.vehicle_number),d(),O(t.vehicle_number)}}function dt(e,i){if(e&1){let t=h();n(0,"select",18),M("ngModelChange",function(r){y(t);let o=s().$implicit;return W(o.trailer,r)||(o.trailer=r),f(r)}),p(1,ct,2,2,"option",19),l()}if(e&2){let t=s().$implicit,a=s();w("ngModel",t.trailer),d(),m("ngForOf",a.vehicleFleetList.trailers)}}function mt(e,i){if(e&1&&(x(0),c(1),H(2,"date"),C()),e&2){let t=s().$implicit;d(),b(" ",V(2,1,t.dataStart,"yyyy-MM-dd HH:mm")," ")}}function _t(e,i){if(e&1){let t=h();n(0,"input",20),M("ngModelChange",function(r){y(t);let o=s().$implicit;return W(o.dataStart,r)||(o.dataStart=r),f(r)}),l()}if(e&2){let t=s().$implicit;w("ngModel",t.dataStart)}}function pt(e,i){if(e&1&&(x(0),c(1),H(2,"date"),C()),e&2){let t=s().$implicit;d(),b(" ",V(2,1,t.dataFinish,"yyyy-MM-dd HH:mm")," ")}}function gt(e,i){if(e&1){let t=h();n(0,"input",20),M("ngModelChange",function(r){y(t);let o=s().$implicit;return W(o.dataFinish,r)||(o.dataFinish=r),f(r)}),l()}if(e&2){let t=s().$implicit;w("ngModel",t.dataFinish)}}function yt(e,i){if(e&1&&(x(0),c(1),C()),e&2){let t=s().$implicit;d(),b(" ",t.notes," ")}}function ft(e,i){if(e&1){let t=h();n(0,"textarea",21),M("ngModelChange",function(r){y(t);let o=s().$implicit;return W(o.notes,r)||(o.notes=r),f(r)}),l()}if(e&2){let t=s().$implicit;w("ngModel",t.notes)}}function ht(e,i){if(e&1){let t=h();n(0,"img",22),E("click",function(){y(t);let r=s().$implicit,o=s();return f(o.editWaybill(r.id))}),l()}}function bt(e,i){if(e&1){let t=h();n(0,"img",23),E("click",function(){y(t);let r=s().$implicit,o=s();return f(o.saveWaybill(r))}),l()}}function ut(e,i){if(e&1){let t=h();n(0,"tr")(1,"td"),p(2,rt,2,1,"ng-container",14)(3,ot,2,2,"ng-template",null,0,S),l(),n(5,"td"),p(6,st,2,1,"ng-container",14)(7,dt,2,2,"ng-template",null,1,S),l(),n(9,"td"),p(10,mt,3,4,"ng-container",14)(11,_t,1,1,"ng-template",null,2,S),l(),n(13,"td"),p(14,pt,3,4,"ng-container",14)(15,gt,1,1,"ng-template",null,3,S),l(),n(17,"td"),c(18),l(),n(19,"td"),c(20),l(),n(21,"td"),p(22,yt,2,1,"ng-container",14)(23,ft,1,1,"ng-template",null,4,S),l(),n(25,"td"),p(26,ht,1,0,"img",15)(27,bt,1,0,"img",16),l(),n(28,"td")(29,"img",17),E("click",function(){let r=y(t).$implicit,o=s();return f(o.deleteWaybill(r.id))}),l()()()}if(e&2){let t=i.$implicit,a=v(4),r=v(8),o=v(12),g=v(16),u=v(24),_=s();d(2),m("ngIf",_.editId!==t.id)("ngIfElse",a),d(4),m("ngIf",_.editId!==t.id)("ngIfElse",r),d(4),m("ngIf",_.editId!==t.id)("ngIfElse",o),d(4),m("ngIf",_.editId!==t.id)("ngIfElse",g),d(4),b(" ",t.tripTime," "),d(2),b(" ",t.billableDays," "),d(2),m("ngIf",_.editId!==t.id)("ngIfElse",u),d(4),m("ngIf",_.editId!==t.id),d(),m("ngIf",_.editId===t.id)}}var it=class e{constructor(i,t,a){this.fb=i;this.vehicleFleetService=t;this.alert=a}listWaybill=[];filteredWaybills=[];selectedMonth;months=["January","February","March","April","May","June","July","August","September","October","November","December"];monthsFromFirebase=[];editId=null;vehicleFleetList={trucks:[],trailers:[]};ngOnInit(){return P(this,null,function*(){(yield this.vehicleFleetService.loadVehicleFleet()).forEach(t=>{t.type==="truck"?this.vehicleFleetList.trucks.push(t):this.vehicleFleetList.trailers.push(t)}),this.listWaybill=yield this.fb.getWillBillsHistory(),this.listWaybill=this.listWaybill.map(t=>{let a=new Date(t.dataStart),g=(new Date(t.dataFinish).getTime()-a.getTime())/(1e3*60*60),u=Math.floor(g),_=Math.floor((g-u)*60),nt=`${u}h ${_}m`,T=a.getMonth();this.monthsFromFirebase.includes(T)||this.monthsFromFirebase.push(T);let F=0;return g<=12?F=.5:g<=24?F=1:F=Math.ceil(g/12)*.5,B(k({},t),{tripTime:nt,billableDays:F,month:T})}),this.filteredWaybills=this.listWaybill})}onMonthChange(i){let t=i.target,a=Number(t.value);this.selectedMonth=a,isNaN(a)?this.filteredWaybills=this.listWaybill:(this.filteredWaybills=this.listWaybill.filter(r=>{let o=new Date(r.dataStart);return console.log(o.getMonth()==a),o.getMonth()==a}),console.log(this.filteredWaybills))}event=event;editWaybill(i){this.editId=i}saveWaybill(i){let{id:t,truck:a,trailer:r,dataStart:o,dataFinish:g,notes:u}=i;this.fb.updateWayBillsHistory(t,{truck:a,trailer:r,dataStart:o,dataFinish:g,notes:u}).then(_=>this.alert.show("success","Waybill updated successfully")),this.editId=null}deleteWaybill(i){return P(this,null,function*(){if(i)try{yield this.fb.deleteWayBillHistory(i),this.listWaybill=this.listWaybill.filter(t=>t.id!==i),this.filteredWaybills=this.filteredWaybills.filter(t=>t.id!==i),this.alert.show("success","Waybill deleted successfully")}catch(t){console.error("Error deleting waybill:",t),this.alert.show("error","Failed to delete waybill")}})}static \u0275fac=function(t){return new(t||e)(I(tt),I(et),I(q))};static \u0275cmp=N({type:e,selectors:[["app-waybill-history"]],decls:33,vars:1,consts:[["editTruck",""],["editTrailer",""],["editStart",""],["editFinish",""],["editNotes",""],[1,"waybill-history"],[3,"change"],["value",""],[3,"value"],[1,"table-striped"],[4,"ngFor","ngForOf"],[1,"btn"],["src","assets/svg/map.svg","alt","+ New Address",1,"icon-svg"],["routerLink","/app/waybill",1,"nav-link"],[4,"ngIf","ngIfElse"],["class","icon-svg","src","assets/svg/edit.svg","alt","Edit",3,"click",4,"ngIf"],["class","icon-svg","src","assets/svg/save.svg","alt","Save",3,"click",4,"ngIf"],["src","assets/svg/delete.svg","alt","Delete",1,"icon-svg",3,"click"],[3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","datetime-local",3,"ngModelChange","ngModel"],["rows","2",3,"ngModelChange","ngModel"],["src","assets/svg/edit.svg","alt","Edit",1,"icon-svg",3,"click"],["src","assets/svg/save.svg","alt","Save",1,"icon-svg",3,"click"]],template:function(t,a){t&1&&(n(0,"section",5)(1,"label"),c(2,"Choose month:"),l(),n(3,"select",6),E("change",function(o){return a.onMonthChange(o)}),n(4,"option",7),c(5,"All"),l(),D(6,lt,2,2,"option",8,L),l(),n(8,"table",9)(9,"tr")(10,"th"),c(11,"Truck"),l(),n(12,"th"),c(13,"Trailer"),l(),n(14,"th"),c(15,"Start"),l(),n(16,"th"),c(17,"Finish"),l(),n(18,"th"),c(19,"Trip Time"),l(),n(20,"th"),c(21,"Billable Days"),l(),n(22,"th"),c(23,"Notes"),l(),n(24,"th"),c(25,"Edit"),l(),n(26,"th"),c(27,"Delete"),l()(),p(28,ut,30,14,"tr",10),l(),n(29,"div",11),A(30,"img",12),n(31,"a",13),c(32,"add new Waybill"),l()()()),t&2&&(d(6),$(a.monthsFromFirebase),d(22),m("ngForOf",a.filteredWaybills))},dependencies:[J,Z,X,Y,G,U,K,Q,z,R,j],styles:[".waybill-history[_ngcontent-%COMP%]{margin:10px;display:flex;flex-direction:column;align-items:center;width:95%;height:100%;border:1px solid white;border-radius:10px;padding:10px;text-align:center;color:#fff;font-size:2vw;background:#1c69af}.waybill-history[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:90%;border-collapse:collapse;margin-top:10px;font-size:10px}.waybill-history[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:green;color:#fff;padding:6px;text-align:center}.waybill-history[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:6px;text-align:center}.waybill-history[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .waybill-history[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .waybill-history[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{max-width:90px;font-size:.5rem}.waybill-history[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background:#fff;color:#000}.waybill-history[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd){background:#e3f1ff;color:#000}.waybill-history[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:#fff;font-weight:700;margin-right:10px}.waybill-history[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:4px 8px;border-radius:6px;border:1px solid #ccc;font-size:1rem}@media screen and (max-width: 660px){.waybill-history[_ngcontent-%COMP%]{font-size:3vw}.waybill-history[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .waybill-history[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:2px;font-size:2.5vw}}input[_ngcontent-%COMP%]{width:100%}"]})};export{it as WaybillHistory};
