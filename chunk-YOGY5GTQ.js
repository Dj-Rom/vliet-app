import{a as O}from"./chunk-H3MELBZE.js";import{a as F}from"./chunk-VZBZQOOD.js";import{h as E}from"./chunk-3RDMHP4V.js";import{a as b,b as m,c as S,d as _,h as y,j as w,k as V,l as N,m as x,n as C,p as q,q as A,s as T}from"./chunk-TG2TCFBS.js";import{g as j}from"./chunk-YQITL2K6.js";import{Da as f,Ia as g,Sa as D,Ta as P,Va as k,Wa as B,Xa as h,Ya as t,Za as l,_a as d,e as v,eb as p,fb as L,lb as n,mb as G,nb as W,ta as c,za as s}from"./chunk-R2RMLZGX.js";function Q(o,i){o&1&&(t(0,"select",10)(1,"option",11),n(2,"VOLVO"),l(),t(3,"option",12),n(4,"DAF"),l(),t(5,"option",13),n(6,"IVECO"),l()())}function X(o,i){o&1&&(t(0,"select",14)(1,"option",15),n(2,"SCHMITZ"),l(),t(3,"option",16),n(4,"OTHER"),l()())}function Y(o,i){o&1&&(t(0,"div",17),n(1," Please write number! For example: PZ1R741 "),l())}var I=class o{constructor(i,e,r,a,u){this.fb=i;this.firebase=e;this.alertService=r;this.vehicleFleetService=a;this.waybill=u;this.vehicleForm=this.fb.group({vehicleBrand:["volvo",m.required],vehicleType:["truck",m.required],vehicleTrailerBrand:["schmitz",m.required],vehicleNumber:["",[m.required,m.minLength(6)]]})}isOpen=!1;vehicleForm;curentType=!1;vehicleFleetArray=[];onTypeChange(i){let e=i.target.value;this.curentType=e==="trailer"}onSubmit(){return v(this,null,function*(){if(this.vehicleFleetArray=yield this.vehicleFleetService.getVehicleFleet(),this.vehicleForm.valid){let{vehicleBrand:i,vehicleType:e,vehicleTrailerBrand:r,vehicleNumber:a}=this.vehicleForm.value;if(this.vehicleFleetArray.find(u=>u.vehicle_number==a.toUpperCase())){this.alertService.show("error","Vehicle already exists"),console.log("Vehicle already exists");return}else this.curentType?yield this.firebase.addVehicleFleet(a.toUpperCase(),e,r):yield this.firebase.addVehicleFleet(a.toUpperCase(),e,i),this.vehicleForm.get("vehicleNumber")?.reset(),this.alertService.show("success","Vehicle added successfully")}else console.log(this.vehicleForm.errors),this.alertService.show("error","Form invalid");this.waybill.setIsOpenModalFormForAddNewVehicle()})}static \u0275fac=function(e){return new(e||o)(s(A),s(E),s(F),s(O),s(M))};static \u0275cmp=f({type:o,selectors:[["app-add-new-vehicle"]],decls:17,vars:4,consts:[[1,"add-new-vehicle"],[3,"ngSubmit","formGroup"],["formControlName","vehicleType",3,"change"],["value","trailer"],["value","truck"],["formControlName","vehicleBrand",4,"ngIf"],["formControlName","vehicleTrailerBrand",4,"ngIf"],["type","text","placeholder","Write Number","formControlName","vehicleNumber","minlength","6"],["class","error",4,"ngIf"],["type","submit",1,"btn"],["formControlName","vehicleBrand"],["value","volvo"],["value","daf"],["value","iveco"],["formControlName","vehicleTrailerBrand"],["value","schmitz"],["value","other"],[1,"error"]],template:function(e,r){if(e&1&&(t(0,"section",0)(1,"h1"),n(2,"Add new vehicle"),l(),t(3,"form",1),p("ngSubmit",function(){return r.onSubmit()}),t(4,"select",2),p("change",function(u){return r.onTypeChange(u)}),t(5,"option",3),n(6,"TRAILER"),l(),t(7,"option",4),n(8,"TRUCK"),l()(),d(9,"br"),g(10,Q,7,0,"select",5),d(11,"br"),g(12,X,5,0,"select",6),d(13,"input",7),g(14,Y,2,0,"div",8),t(15,"button",9),n(16,"SAVE"),l()()()),e&2){let a;c(3),h("formGroup",r.vehicleForm),c(7),h("ngIf",!r.curentType),c(2),h("ngIf",r.curentType),c(2),h("ngIf",((a=r.vehicleForm.get("vehicleNumber"))==null?null:a.touched)&&((a=r.vehicleForm.get("vehicleNumber"))==null?null:a.invalid))}},dependencies:[T,y,x,C,b,N,S,_,q,w,V,j],styles:[".add-new-vehicle[_ngcontent-%COMP%]{width:400px;max-width:100%;height:100%;background:#1c69af;padding:10px;display:flex;flex-direction:column;align-content:center;align-items:center;border:2px solid white}.add-new-vehicle[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;height:100vh;background:beige;top:0;left:0;position:absolute;flex-direction:column;align-content:center;align-items:center;width:100%;z-index:100}select[_ngcontent-%COMP%], input[_ngcontent-%COMP%], button[_ngcontent-%COMP%]{margin-top:30px;width:90%;height:50px;background:var(--dark-color);color:var(--primary-color);margin-bottom:10px}"]})};var R=(o,i)=>i.id;function ee(o,i){if(o&1&&(t(0,"app-add-new-vehicle"),n(1),l()),o&2){let e=L();c(),G(e.isOpenModalFormForAddNewVehicle)}}function te(o,i){if(o&1&&(t(0,"option"),n(1),l()),o&2){let e=i.$implicit;c(),W(" ",e.vehicle_number," ")}}function ie(o,i){if(o&1&&(t(0,"option"),n(1),l()),o&2){let e=i.$implicit;c(),W(" ",e.vehicle_number," ")}}var M=class o{constructor(i,e,r,a){this.alertService=i;this.vehicleFleetService=e;this.fb=r;this.formBuilder=a;this.form=this.formBuilder.group({dataStart:["",[m.required]],dataFinish:["",[m.required]],truck:["",m.required],trailer:["",m.required],notes:[""]},{validators:this.finishAfterStartValidator})}vehicleFleetList={trucks:[],trailers:[]};form;isOpenModalFormForAddNewVehicle=!1;ngOnInit(){return v(this,null,function*(){(yield this.vehicleFleetService.loadVehicleFleet()).forEach(e=>{e.type==="truck"?this.vehicleFleetList.trucks.push(e):this.vehicleFleetList.trailers.push(e)}),this.form.patchValue({truck:this.vehicleFleetList.trucks[0]?.vehicle_number||"",trailer:this.vehicleFleetList.trailers[0]?.vehicle_number||""}),console.log("Vehicle list:",this.vehicleFleetList)})}finishAfterStartValidator(i){let e=i.get("dataStart")?.value,r=i.get("dataFinish")?.value;if(!e||!r)return null;let a=new Date(e);return new Date(r)<a?{finishBeforeStart:!0}:null}onSubmit(){this.form.valid?this.fb.addInfoForCurrentUser(this.form.value).then(()=>{this.alertService.show("success","Waybill saved successfully"),this.form.reset()}).catch(i=>{this.alertService.show("error","Error saving waybill:")}):(this.alertService.show("error",`Form invalid ${this.form.errors}`),this.form.markAllAsTouched())}get dataStart(){return this.form.get("dataStart")}get dataFinish(){return this.form.get("dataFinish")}get truck(){return this.form.get("truck")}get trailer(){return this.form.get("trailer")}setIsOpenModalFormForAddNewVehicle(){this.isOpenModalFormForAddNewVehicle=!this.isOpenModalFormForAddNewVehicle}addTrailer(i){i==="add"&&(this.isOpenModalFormForAddNewVehicle=!0)}static \u0275fac=function(e){return new(e||o)(s(F),s(O),s(E),s(A))};static \u0275cmp=f({type:o,selectors:[["app-waybill"]],decls:27,vars:2,consts:[[1,"formWaybill",3,"ngSubmit","formGroup"],["for","truck"],["name","truck","formControlName","truck",3,"change"],["value","add"],["for","trailer"],["name","trailer","formControlName","trailer",3,"change"],["formControlName","dataStart","type","datetime-local"],["formControlName","dataFinish","type","datetime-local"],["formControlName","notes","name","","id","","cols","30","rows","10","placeholder","Notes"],["type","submit",1,"btn"]],template:function(e,r){e&1&&(t(0,"form",0),p("ngSubmit",function(){return r.onSubmit()}),t(1,"h2"),n(2,"Waybill"),l(),D(3,ee,2,1,"app-add-new-vehicle"),t(4,"label",1),n(5,"Truck:"),l(),t(6,"select",2),p("change",function(){return r.addTrailer(r.form.value.truck)}),k(7,te,2,1,"option",null,R),t(9,"option",3),n(10," add "),l()(),t(11,"label",4),n(12,"Trailer:"),l(),t(13,"select",5),p("change",function(){return r.addTrailer(r.form.value.trailer)}),k(14,ie,2,1,"option",null,R),t(16,"option",3),n(17," add "),l()(),t(18,"label"),n(19," Start: "),d(20,"input",6),l(),t(21,"label"),n(22," Finish: "),d(23,"input",7),l(),d(24,"textarea",8),t(25,"button",9),n(26,"SAVE"),l()()),e&2&&(h("formGroup",r.form),c(3),P(r.isOpenModalFormForAddNewVehicle?3:-1),c(4),B(r.vehicleFleetList.trucks),c(7),B(r.vehicleFleetList.trailers))},dependencies:[T,y,x,C,b,N,S,_,w,V,I],styles:[".formWaybill[_ngcontent-%COMP%]{width:80vw;max-width:600px;height:70vh;background:#1c69af;border:2px solid white;padding:10px;border-radius:8px;margin:10px auto;display:flex;flex-direction:column;align-items:stretch;justify-content:center;color:#fff;font-size:18px}h2[_ngcontent-%COMP%]{text-align:center}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{margin-bottom:20px;margin-top:5px;width:100%;height:30px}textarea[_ngcontent-%COMP%]{margin-bottom:30px}"]})};export{M as a,I as b};
