import{f as J}from"./chunk-UJ2NWYAZ.js";import{a as et}from"./chunk-H3MELBZE.js";import{a as q}from"./chunk-VZBZQOOD.js";import{h as tt}from"./chunk-3RDMHP4V.js";import{a as G,c as K,g as Q,l as U,m as X,n as Y,r as Z}from"./chunk-TG2TCFBS.js";import{f as z,g as R,h as j}from"./chunk-YQITL2K6.js";import{$a as u,Da as N,Ia as p,Ua as L,Va as D,Wa as $,Xa as m,Y as y,Ya as r,Z as f,Za as n,_a as A,a as k,ab as C,b as B,bb as h,e as P,eb as E,fb as s,gb as w,lb as c,mb as O,nb as b,pb as v,qb as M,rb as W,ta as d,ub as H,wb as V,xb as S,za as I}from"./chunk-R2RMLZGX.js";function lt(e,i){if(e&1&&(r(0,"option",8),c(1),n()),e&2){let t=i.$implicit,a=s();m("value",t),d(),O(a.months[t])}}function rt(e,i){if(e&1&&(u(0),c(1),C()),e&2){let t=s().$implicit;d(),b(" ",t.truck," ")}}function at(e,i){if(e&1&&(r(0,"option",8),c(1),n()),e&2){let t=i.$implicit;m("value",t.vehicle_number),d(),O(t.vehicle_number)}}function ot(e,i){if(e&1){let t=h();r(0,"select",17),W("ngModelChange",function(l){y(t);let o=s().$implicit;return M(o.truck,l)||(o.truck=l),f(l)}),p(1,at,2,2,"option",18),n()}if(e&2){let t=s().$implicit,a=s();v("ngModel",t.truck),d(),m("ngForOf",a.vehicleFleetList.trucks)}}function st(e,i){if(e&1&&(u(0),c(1),C()),e&2){let t=s().$implicit;d(),b(" ",t.trailer," ")}}function ct(e,i){if(e&1&&(r(0,"option",8),c(1),n()),e&2){let t=i.$implicit;m("value",t.vehicle_number),d(),O(t.vehicle_number)}}function dt(e,i){if(e&1){let t=h();r(0,"select",17),W("ngModelChange",function(l){y(t);let o=s().$implicit;return M(o.trailer,l)||(o.trailer=l),f(l)}),p(1,ct,2,2,"option",18),n()}if(e&2){let t=s().$implicit,a=s();v("ngModel",t.trailer),d(),m("ngForOf",a.vehicleFleetList.trailers)}}function mt(e,i){if(e&1&&(u(0),c(1),H(2,"date"),C()),e&2){let t=s().$implicit;d(),b(" ",V(2,1,t.dataStart,"yyyy-MM-dd HH:mm")," ")}}function _t(e,i){if(e&1){let t=h();r(0,"input",19),W("ngModelChange",function(l){y(t);let o=s().$implicit;return M(o.dataStart,l)||(o.dataStart=l),f(l)}),n()}if(e&2){let t=s().$implicit;v("ngModel",t.dataStart)}}function pt(e,i){if(e&1&&(u(0),c(1),H(2,"date"),C()),e&2){let t=s().$implicit;d(),b(" ",V(2,1,t.dataFinish,"yyyy-MM-dd HH:mm")," ")}}function gt(e,i){if(e&1){let t=h();r(0,"input",19),W("ngModelChange",function(l){y(t);let o=s().$implicit;return M(o.dataFinish,l)||(o.dataFinish=l),f(l)}),n()}if(e&2){let t=s().$implicit;v("ngModel",t.dataFinish)}}function yt(e,i){if(e&1&&(u(0),c(1),C()),e&2){let t=s().$implicit;d(),b(" ",t.notes," ")}}function ft(e,i){if(e&1){let t=h();r(0,"textarea",20),W("ngModelChange",function(l){y(t);let o=s().$implicit;return M(o.notes,l)||(o.notes=l),f(l)}),n()}if(e&2){let t=s().$implicit;v("ngModel",t.notes)}}function ht(e,i){if(e&1){let t=h();r(0,"img",21),E("click",function(){y(t);let l=s().$implicit,o=s();return f(o.editWaybill(l.id))}),n()}}function bt(e,i){if(e&1){let t=h();r(0,"img",22),E("click",function(){y(t);let l=s().$implicit,o=s();return f(o.saveWaybill(l))}),n()}}function xt(e,i){if(e&1){let t=h();r(0,"tr")(1,"td"),p(2,rt,2,1,"ng-container",13)(3,ot,2,2,"ng-template",null,0,S),n(),r(5,"td"),p(6,st,2,1,"ng-container",13)(7,dt,2,2,"ng-template",null,1,S),n(),r(9,"td"),p(10,mt,3,4,"ng-container",13)(11,_t,1,1,"ng-template",null,2,S),n(),r(13,"td"),p(14,pt,3,4,"ng-container",13)(15,gt,1,1,"ng-template",null,3,S),n(),r(17,"td"),c(18),n(),r(19,"td"),c(20),n(),r(21,"td"),p(22,yt,2,1,"ng-container",13)(23,ft,1,1,"ng-template",null,4,S),n(),r(25,"td"),p(26,ht,1,0,"img",14)(27,bt,1,0,"img",15),n(),r(28,"td")(29,"img",16),E("click",function(){let l=y(t).$implicit,o=s();return f(o.deleteWaybill(l.id))}),n()()()}if(e&2){let t=i.$implicit,a=w(4),l=w(8),o=w(12),g=w(16),x=w(24),_=s();d(2),m("ngIf",_.editId!==t.id)("ngIfElse",a),d(4),m("ngIf",_.editId!==t.id)("ngIfElse",l),d(4),m("ngIf",_.editId!==t.id)("ngIfElse",o),d(4),m("ngIf",_.editId!==t.id)("ngIfElse",g),d(4),b(" ",t.tripTime," "),d(2),b(" ",t.billableDays," "),d(2),m("ngIf",_.editId!==t.id)("ngIfElse",x),d(4),m("ngIf",_.editId!==t.id),d(),m("ngIf",_.editId===t.id)}}var it=class e{constructor(i,t,a){this.fb=i;this.vehicleFleetService=t;this.alert=a}listWaybill=[];filteredWaybills=[];selectedMonth;months=["January","February","March","April","May","June","July","August","September","October","November","December"];monthsFromFirebase=[];editId=null;vehicleFleetList={trucks:[],trailers:[]};ngOnInit(){return P(this,null,function*(){(yield this.vehicleFleetService.loadVehicleFleet()).forEach(t=>{t.type==="truck"?this.vehicleFleetList.trucks.push(t):this.vehicleFleetList.trailers.push(t)}),this.listWaybill=yield this.fb.getWillBillsHistory(),this.listWaybill=this.listWaybill.map(t=>{let a=new Date(t.dataStart),g=(new Date(t.dataFinish).getTime()-a.getTime())/(1e3*60*60),x=Math.floor(g),_=Math.floor((g-x)*60),nt=`${x}h ${_}m`,T=a.getMonth();this.monthsFromFirebase.includes(T)||this.monthsFromFirebase.push(T);let F=0;return g<=12?F=.5:g<=24?F=1:F=Math.ceil(g/12)*.5,B(k({},t),{tripTime:nt,billableDays:F,month:T})}),this.filteredWaybills=this.listWaybill})}onMonthChange(i){let t=i.target,a=Number(t.value);this.selectedMonth=a,isNaN(a)?this.filteredWaybills=this.listWaybill:(this.filteredWaybills=this.listWaybill.filter(l=>{let o=new Date(l.dataStart);return console.log(o.getMonth()==a),o.getMonth()==a}),console.log(this.filteredWaybills))}event=event;editWaybill(i){this.editId=i}saveWaybill(i){let{id:t,truck:a,trailer:l,dataStart:o,dataFinish:g,notes:x}=i;this.fb.updateWayBillsHistory(t,{truck:a,trailer:l,dataStart:o,dataFinish:g,notes:x}).then(_=>this.alert.show("success","Waybill updated successfully")),this.editId=null}deleteWaybill(i){return P(this,null,function*(){if(i)try{yield this.fb.deleteWayBillHistory(i),this.listWaybill=this.listWaybill.filter(t=>t.id!==i),this.filteredWaybills=this.filteredWaybills.filter(t=>t.id!==i),this.alert.show("success","Waybill deleted successfully")}catch(t){console.error("Error deleting waybill:",t),this.alert.show("error","Failed to delete waybill")}})}static \u0275fac=function(t){return new(t||e)(I(tt),I(et),I(q))};static \u0275cmp=N({type:e,selectors:[["app-waybill-history"]],decls:32,vars:1,consts:[["editTruck",""],["editTrailer",""],["editStart",""],["editFinish",""],["editNotes",""],[1,"waybill-history"],[3,"change"],["value",""],[3,"value"],[1,"table-striped"],[4,"ngFor","ngForOf"],["routerLink","/app/waybill",1,"button-add","font400size14"],["src","assets/svg/map.svg","alt","+ New Address",1,"icon-svg"],[4,"ngIf","ngIfElse"],["class","icon-svg","src","assets/svg/edit.svg","alt","Edit",3,"click",4,"ngIf"],["class","icon-svg","src","assets/svg/save.svg","alt","Save",3,"click",4,"ngIf"],["src","assets/svg/delete.svg","alt","Delete",1,"icon-svg",3,"click"],[3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","datetime-local",3,"ngModelChange","ngModel"],["rows","2",3,"ngModelChange","ngModel"],["src","assets/svg/edit.svg","alt","Edit",1,"icon-svg",3,"click"],["src","assets/svg/save.svg","alt","Save",1,"icon-svg",3,"click"]],template:function(t,a){t&1&&(r(0,"section",5)(1,"label"),c(2,"Choose month:"),n(),r(3,"select",6),E("change",function(o){return a.onMonthChange(o)}),r(4,"option",7),c(5,"All"),n(),D(6,lt,2,2,"option",8,L),n(),r(8,"table",9)(9,"tr")(10,"th"),c(11,"Truck"),n(),r(12,"th"),c(13,"Trailer"),n(),r(14,"th"),c(15,"Start"),n(),r(16,"th"),c(17,"Finish"),n(),r(18,"th"),c(19,"Trip Time"),n(),r(20,"th"),c(21,"Billable Days"),n(),r(22,"th"),c(23,"Notes"),n(),r(24,"th"),c(25,"Edit"),n(),r(26,"th"),c(27,"Delete"),n()(),p(28,xt,30,14,"tr",10),n(),r(29,"button",11),A(30,"img",12),c(31,"add new Waybill "),n()()),t&2&&(d(6),$(a.monthsFromFirebase),d(22),m("ngForOf",a.filteredWaybills))},dependencies:[J,Z,X,Y,G,U,K,Q,z,R,j],styles:[".waybill-history[_ngcontent-%COMP%]{margin:10px;display:flex;flex-direction:column;align-items:center;width:95%;height:calc(100% + 68px);border:1px solid white;border-radius:10px;padding:10px;text-align:center;color:#fff;font-size:2vw;background:#1c69af}.waybill-history[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:90%;border-collapse:collapse;margin-top:10px;font-size:10px}.waybill-history[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:green;color:#fff;padding:6px;text-align:center}.waybill-history[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:6px;text-align:center}.waybill-history[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .waybill-history[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .waybill-history[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{max-width:90px;font-size:.5rem}.waybill-history[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background:#fff;color:#000}.waybill-history[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd){background:#e3f1ff;color:#000}.waybill-history[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:#fff;font-weight:700;margin-right:10px}.waybill-history[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:4px 8px;border-radius:6px;border:1px solid #ccc;font-size:1rem}.button-add[_ngcontent-%COMP%]{background:green;color:#fff;margin-top:16px;width:95%;height:44px;border-radius:4px;angle:0 deg;opacity:1;gap:8px;padding:10px 18px;display:flex;align-items:center;justify-content:center}@media screen and (max-width: 660px){.waybill-history[_ngcontent-%COMP%]{position:relative;font-size:3vw;height:calc(100% + 168px)}.waybill-history[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .waybill-history[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:2px;font-size:2.5vw}}input[_ngcontent-%COMP%]{width:100%}"]})};export{it as WaybillHistory};
